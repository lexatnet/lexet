FROM ubuntu:focal

ARG context_root=
ARG build_root=/build
ARG build_script=$build_root/appimage-builder-build-script.sh
ARG entrypoint_script=$build_root/appimage-builder-entrypoint.sh

COPY $context_root/docker $build_root/docker
COPY $context_root/config/config.sh $build_root/config/config.sh
COPY $context_root/scripts/lib $build_root/scripts/lib

RUN chmod -R 777 $build_root

RUN $build_script
RUN apt-get install -y apt-transport-https ca-certificates
RUN update-ca-certificates
RUN rm -rf /var/lib/apt/lists/

EXPOSE 2222

ENV ENTRYPOINT_SCRIPT=${entrypoint_script}

SHELL ["/bin/bash", "-c"]

ENTRYPOINT ["bash", "-c", "${ENTRYPOINT_SCRIPT}"]
